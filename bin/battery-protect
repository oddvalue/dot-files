#!/bin/bash
if test -f $HOME/.env ; then
  . $HOME/.env

  battery_state=$(upower -i $(upower -e | grep BAT) | grep -E "state" | awk '{print $2}')
  battery_percentage=$(upower -i $(upower -e | grep BAT) | grep -E "percentage" | awk '{print $2}' | tr -d '%')

  if [ "$battery_state" == "discharging" ] && [ $battery_percentage -lt 75 ]; then
      curl -XPOST -d '{"value":"on"}' -H "Content-Type: application/json" $BATTERY_PROTECT_WEBHOOK
  elif [ "$battery_state" == "charging" ] && [ $battery_percentage -gt 80 ]; then
      curl -XPOST -d '{"value":"off"}' -H "Content-Type: application/json" $BATTERY_PROTECT_WEBHOOK
  fi
fi
